<!DOCTYPE html >
<html lang="fr">
  <head>
    <title>Demonstration de l'algorithme de Carte Ã  Puce</title>
    <meta charset="UTF-8">
    <meta name="csrf-param" content="authenticity_token" />
    <meta name="csrf-token" content="9652VEDGo4DhfVcg0IQ9OaUu3cofUgsZ7daT19JMYXjVe9tDcKgqxe5f0ue4Qx4DiFx+QsfLRmctTcvMgPsn5A==" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js'></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-language/v0.9.2/mapbox-gl-language.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.6/nv.d3.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.4/mapbox-gl-draw.js'></script>
    <!--<script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>-->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Turf.js/5.0.4/turf.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/10.1.0/nouislider.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.4/js/all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen.jquery.js"></script>

    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.6/nv.d3.css" />-->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css' rel='stylesheet' />
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.4/mapbox-gl-draw.css' type='text/css'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/10.1.0/nouislider.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.2/chosen.css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">

  </head>

  <body>
    <style>
      html,body,#map{
        position:absolute;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow:hidden;
      }

      #sceneController{
        position:absolute;
        float: left; 
        background-color: rgba(255,255,255,0.1); 
        width: 100%;
        z-index: 99999;
      }

      #sceneId {
        color: #ffffff;
      }
    </style>



<div id="map"></div>
<div id="sceneController" >
  <button id="backward"><</button>
  <button id="forward">></button>
  <span id="sceneId">0/14</span>
</div>
<script>
  const emptyGeoJSON = {"type": "FeatureCollection", "features": []};
  const routeGeoJSON = {
    "type": "FeatureCollection",
    "features": [{
      "type": "Feature",
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [-73.3850445850057, 45.5065793617423],
          [-73.3847967312821, 45.5065183375857],
          [-73.3837769561767, 45.506273803594],
          [-73.382497952656, 45.5059670921593],
          [-73.3823632604219, 45.505930959827],
          [-73.3821845810646, 45.5058902827638],
          [-73.3821175330909, 45.5060206907687],
          [-73.3818414008288, 45.5066201748235],
          [-73.3813345206274, 45.5077205822768],
          [-73.3807008834374, 45.5074184751017],
          [-73.3806263583278, 45.5074813862111],
          [-73.3805029631278, 45.5075847390642],
          [-73.3803992210073, 45.5076656163027],
          [-73.3802679595778, 45.5077593062542],
          [-73.3801789222152, 45.5078228578411],
          [-73.3800591980273, 45.5078902203678],
          [-73.379862662231, 45.5079754988566],
          [-73.379723779183, 45.5080248440336],
          [-73.3796221434502, 45.5080472330309],
          [-73.3795257066887, 45.5080741266323],
          [-73.379404310305, 45.5080909137717],
          [-73.3792996837939, 45.5081053825123],
          [-73.3791507257082, 45.5081139975836],
          [-73.3791468859225, 45.5081142193817],
          [-73.3785622862021, 45.508140100652],
          [-73.3784521475787, 45.5081449767367],
          [-73.3781185755741, 45.5081626181573],
          [-73.3779330157937, 45.5081534215973],
          [-73.3778782435153, 45.5081501614161],
          [-73.3777790663458, 45.5081442585615],
          [-73.3776987036003, 45.5081351741272],
          [-73.3775707853363, 45.5081080418327],
          [-73.3774424704678, 45.5080809089694],
          [-73.3771135426746, 45.5079815729431],
          [-73.3769139524693, 45.507916509122],
          [-73.3768682000836, 45.5079015944193],
          [-73.3768365931497, 45.5078912904452],
          [-73.3766316182273, 45.5078010850288],
          [-73.3765122076341, 45.5077289686194],
          [-73.376399619445, 45.5076388626198],
          [-73.3763449709828, 45.5075758145125],
          [-73.3762979115819, 45.5075127745968],
          [-73.3762684419627, 45.5074587521387],
          [-73.3760840445819, 45.5071076137251],
          [-73.3760458398676, 45.5070220872447],
          [-73.3759845352851, 45.506896042764],
          [-73.3759108500966, 45.5067609863746],
          [-73.3758589928507, 45.506697941057],
          [-73.3757835700179, 45.5066258716672],
          [-73.3757481055642, 45.5065969652502],
          [-73.3754242900218, 45.5063330315989],
          [-73.3752946429409, 45.5062380683294],
          [-73.3751464319439, 45.5061295059981],
          [-73.3750613452224, 45.5060671816545],
          [-73.3749511912883, 45.5059725776503],
          [-73.3748440141099, 45.5057879925378],
          [-73.3747457446357, 45.5055629241668],
          [-73.3746202694289, 45.5053378258447],
          [-73.3745811149737, 45.5051398174653],
          [-73.3745648021259, 45.5049193380809],
          [-73.3745833739766, 45.5048428718374],
          [-73.3745978804068, 45.5047933964105],
          [-73.3746252036945, 45.5047349366214],
          [-73.3746971429496, 45.5046345724031],
          [-73.3747218765815, 45.5046000662638],
          [-73.3748542295814, 45.5044292412027],
          [-73.3749978657548, 45.5042134361872],
          [-73.3751703460646, 45.5039796656487],
          [-73.3752929865956, 45.5038538215934],
          [-73.3754468546471, 45.5037145138129],
          [-73.3756984943777, 45.5034853279566],
          [-73.3759724865499, 45.5032741626689],
          [-73.3760163531029, 45.5032468604602],
          [-73.3763188636911, 45.5030585758972],
          [-73.3764109829527, 45.502995686586],
          [-73.3753606058433, 45.5025716190722],
          [-73.3752487067524, 45.5025400024125],
          [-73.3751839881231, 45.5025084372051],
          [-73.3750953090191, 45.5024678473325],
          [-73.3750018186022, 45.502427252126],
          [-73.3749346774327, 45.5024091817732],
          [-73.3748899399292, 45.5023866367047],
          [-73.374857582208, 45.5023731036132],
          [-73.3748228387261, 45.5023505694665],
          [-73.3747805369514, 45.5023145293763],
          [-73.374739891818, 45.5022469965755],
          [-73.374725695497, 45.5021569966883],
          [-73.3746908250014, 45.5020129835275],
          [-73.3751534662046, 45.501078896655],
          [-73.3751881975129, 45.501008772021],
          [-73.3752368916467, 45.5009138107519],
          [-73.3759686173992, 45.4994567027408],
          [-73.3760414144179, 45.4993117359645],
          [-73.3762079423471, 45.4989931613286],
          [-73.3762840925636, 45.4988566466524],
          [-73.3763632915593, 45.49870085517],
          [-73.3765634016836, 45.4983113321461],
          [-73.3767730990695, 45.497866135849],
          [-73.3770405535426, 45.4973374841007],
          [-73.3773418108667, 45.496707214396],
          [-73.3775826194855, 45.4962209288129],
          [-73.3781240625785, 45.495127517665],
          [-73.3785038238845, 45.4943641271133],
          [-73.3789703598438, 45.4934243352563],
          [-73.3790246118523, 45.4933161648169],
          [-73.3802366214858, 45.4908716620311],
          [-73.3809771046346, 45.4893780713262],
          [-73.381377149744, 45.4885674506056],
          [-73.3816625960516, 45.4879918456229],
          [-73.381705964553, 45.4879064052256],
          [-73.3818021139319, 45.4877705741003],
          [-73.3819367666613, 45.4876271430046],
          [-73.3821490414172, 45.4874310879037],
          [-73.382303685578, 45.487304126167],
          [-73.3823902381283, 45.4872142307583],
          [-73.3825036614039, 45.4872716865401],
          [-73.3826394389051, 45.4873404654382],
          [-73.3832021590355, 45.4876154950788],
          [-73.3839534072826, 45.4879761989335],
          [-73.3846987329847, 45.4883098964849],
          [-73.3847283500223, 45.4883201972112],
          [-73.3849008998085, 45.4883685903191],
          [-73.3849776919058, 45.4882670337332],
          [-73.3849878078568, 45.4882536551193],
          [-73.3852853679003, 45.4878425674975],
          [-73.3855376671493, 45.4874288916634],
          [-73.3857081896006, 45.4871231149197],
          [-73.3857940157961, 45.4867947571171],
          [-73.3858218923339, 45.4866486860471],
          [-73.3858489542032, 45.4865068614241],
          [-73.3858703562373, 45.4864436776492],
          [-73.3859205472949, 45.4862954692093],
          [-73.38600932043, 45.4860840940872],
          [-73.3861084207851, 45.4859087230161],
          [-73.3862820612722, 45.4856389422754],
          [-73.3864560461902, 45.485400656205],
          [-73.3867931479511, 45.4849510678466],
          [-73.3872665397576, 45.4843126453844],
          [-73.3875583137848, 45.4841419622192],
          [-73.3877430546555, 45.4839126831741],
          [-73.3882709355439, 45.4832023222739],
          [-73.3883178276879, 45.4831393788963],
          [-73.3889094602569, 45.4823255949346],
          [-73.389050233159, 45.4820917717024],
          [-73.3891127784648, 45.4819973485657],
          [-73.3893433649264, 45.4818266013583],
          [-73.3894353734577, 45.4817951958278],
          [-73.3895385178826, 45.4817862971526],
          [-73.3896276633604, 45.4817863833229],
          [-73.3897091842229, 45.4817999597584],
          [-73.3900708921615, 45.4819271057793],
          [-73.3903134919291, 45.4820569978541],
          [-73.3905179669869, 45.4821623338632],
          [-73.3931660880496, 45.4835264507823],
          [-73.3937151855087, 45.4838284114584],
          [-73.3939208220952, 45.4839500818289],
          [-73.3941827422986, 45.4841212955117],
          [-73.3943260734669, 45.4842204112616],
          [-73.394525692416, 45.4843600718877],
          [-73.3948518323275, 45.484607830211],
          [-73.3950973212356, 45.4848060220288],
          [-73.3953471663518, 45.485022214221],
          [-73.3955934065449, 45.4852519002517],
          [-73.3963164284977, 45.4859904323708],
          [-73.3968774575437, 45.4865623422466],
          [-73.3979875997424, 45.4876926452353],
          [-73.3985027693842, 45.4882240129502],
          [-73.4002921747855, 45.4900612731877],
          [-73.4006312570046, 45.4904030778615],
          [-73.40072997745, 45.4905025785757],
          [-73.4010301249667, 45.4907907894232],
          [-73.4014712473353, 45.491169105645],
          [-73.4019563689528, 45.4915429586868],
          [-73.4022494808898, 45.4917411757557],
          [-73.4023565138182, 45.4918087556595],
          [-73.4025102675535, 45.491907869914],
          [-73.4025605960704, 45.491939407424],
          [-73.4030762409872, 45.4922412941115],
          [-73.4034545105464, 45.4924440795116],
          [-73.4039275110747, 45.4926694394811],
          [-73.405645706207, 45.4934448558928],
          [-73.4064648251307, 45.4938145054014],
          [-73.4070437977257, 45.4940757754421],
          [-73.4073178948688, 45.4942067725574],
          [-73.4074492969785, 45.4942695712585],
          [-73.4081380108716, 45.4946345641698],
          [-73.4087080658734, 45.4949499666978],
          [-73.4087484096291, 45.4949724950411],
          [-73.408851471759, 45.4950355664268],
          [-73.4093000581087, 45.4952968783334],
          [-73.4103978397728, 45.4959096387769],
          [-73.4107286311463, 45.496085367381],
          [-73.411068248786, 45.4962476042318],
          [-73.4115598328411, 45.4964612120451],
          [-73.4115868875193, 45.496472967855],
          [-73.4122710373109, 45.4967299508883],
          [-73.4128640507467, 45.496955365789],
          [-73.4157331570799, 45.4979980645523],
          [-73.4166354151275, 45.4983259430812],
          [-73.4167229342801, 45.4983620006699],
          [-73.4173123805041, 45.4985918890302],
          [-73.4174346393683, 45.4986479342467],
          [-73.4176072870144, 45.4987270786823],
          [-73.4180420098013, 45.49895235234],
          [-73.4183354478765, 45.4991277620617],
          [-73.4184790769053, 45.4992136197533],
          [-73.4187643085687, 45.4994072893338],
          [-73.4192093557251, 45.4997373535473],
          [-73.419304752318, 45.4998081027891],
          [-73.4197294135182, 45.500091852702],
          [-73.4198784345874, 45.5001819416727],
          [-73.4203423334582, 45.5004297230648],
          [-73.4207838938638, 45.5006414933365],
          [-73.420877817257, 45.500677552168],
          [-73.4210888319407, 45.5007631832565],
          [-73.4215568522837, 45.5009344758517],
          [-73.4217267095352, 45.5009975814034],
          [-73.422540874685, 45.5012860862532],
          [-73.4230176947471, 45.5014573788139],
          [-73.4234225755493, 45.5016016258776],
          [-73.4261840737895, 45.5025842728101],
          [-73.4277877026949, 45.5031521989479],
          [-73.4280830834403, 45.5032648656703],
          [-73.4282729275316, 45.5033504701181],
          [-73.4285119041048, 45.5034720987265],
          [-73.4286433697479, 45.5035486675766],
          [-73.4288839036925, 45.5037152885221],
          [-73.4289917619533, 45.5038008406975],
          [-73.4291747126078, 45.5039674252139],
          [-73.4292533767155, 45.5040574582482],
          [-73.4293324562005, 45.5041429922697],
          [-73.4293827640499, 45.5042015131667],
          [-73.42949412599, 45.5043725520954],
          [-73.4295994588255, 45.5045660832649],
          [-73.4296477037617, 45.5046785933364],
          [-73.4296562146364, 45.5047076527012],
          [-73.4297584133515, 45.5050565954202],
          [-73.4300256564929, 45.5062625485515],
          [-73.4300658441286, 45.5064245448146],
          [-73.430098878865, 45.5065550421954],
          [-73.4301032460799, 45.5065730417173],
          [-73.4302001399668, 45.5068070600039],
          [-73.4303413735178, 45.5070860973657],
          [-73.4304847249904, 45.5072571547447],
          [-73.4306077810445, 45.5073652106472],
          [-73.4306717079105, 45.5074147407922],
          [-73.4313582332856, 45.5078560781208],
          [-73.4316087994561, 45.5080137008073],
          [-73.4316663399808, 45.5080542281438],
          [-73.4324819863939, 45.5085586247882],
          [-73.4330207093034, 45.5088828851066],
          [-73.4333948627264, 45.5090816306401],
          [-73.4334531604457, 45.5091125975882],
          [-73.4337397545282, 45.5092567389174],
          [-73.4341278834039, 45.5094279333804],
          [-73.434760273492, 45.5097027481114],
          [-73.4354782147629, 45.5100091021499],
          [-73.4357580355394, 45.5101307385189],
          [-73.4358931432224, 45.5101893041454],
          [-73.4371827390762, 45.5107524217501],
          [-73.4379382709123, 45.5110812769797],
          [-73.438224094908, 45.5112119089634],
          [-73.4390084191643, 45.511567767906],
          [-73.4397379978941, 45.5118786004919],
          [-73.4398295411633, 45.5119191416216],
          [-73.4398963033166, 45.5119506712253],
          [-73.4402373095026, 45.5120948247967],
          [-73.4414478403632, 45.5126128605937],
          [-73.441810837015, 45.5127750175504],
          [-73.4430614069855, 45.5132795589533],
          [-73.4466456539642, 45.5148110194757],
          [-73.4485396252325, 45.5155902509502],
          [-73.449494433774, 45.5159776087279],
          [-73.4502957002108, 45.5163198997464],
          [-73.4513728768629, 45.5167612854038],
          [-73.451903081298, 45.5169819708808],
          [-73.4520534167382, 45.5170540213455],
          [-73.4522397225978, 45.5171530818802],
          [-73.4525176181444, 45.5172746762363],
          [-73.4540882709967, 45.5179142052212],
          [-73.4547638064745, 45.5181934298343],
          [-73.4556245564052, 45.5185491999896],
          [-73.4563099434223, 45.5188374131606],
          [-73.4571492956101, 45.5191796704924],
          [-73.4572676566637, 45.5192337052589],
          [-73.4585820636636, 45.5197875912543],
          [-73.4603262273531, 45.5205184892416],
          [-73.4605125622783, 45.5205966203465],
          [-73.462791421484, 45.5215527267805],
          [-73.4638232106526, 45.5219759830331],
          [-73.4642151337851, 45.5221380776841],
          [-73.4643523151598, 45.5221876117757],
          [-73.464458679338, 45.5222461345181],
          [-73.4646066425929, 45.5223316652567],
          [-73.4654964863571, 45.5226873742758],
          [-73.4660016018356, 45.5228989881044],
          [-73.4662763873113, 45.5229665575477],
          [-73.4672366344253, 45.523362766526],
          [-73.4680477142421, 45.5237049353929],
          [-73.4688660031961, 45.5240381020484],
          [-73.4695215204992, 45.5243217283282],
          [-73.4697211017057, 45.524402766973],
          [-73.4702394419223, 45.5246233638993],
          [-73.4705550086082, 45.524749423221],
          [-73.471094153135, 45.5249790200118],
          [-73.4719968699811, 45.5253571774725],
          [-73.4726236233027, 45.5256227820412],
          [-73.4732747804939, 45.5258928880677],
          [-73.4739867399966, 45.5261899994127],
          [-73.4747311044939, 45.5264961118708],
          [-73.4754674847459, 45.5268112161401],
          [-73.4758938699766, 45.5269822763722],
          [-73.4762194698646, 45.5271173205025],
          [-73.4769690545147, 45.52742791861],
          [-73.4777246480742, 45.5277475113448],
          [-73.4785982551464, 45.5281166123833],
          [-73.4794542753698, 45.5284722059699],
          [-73.4801635074508, 45.5287737773872],
          [-73.4808895341783, 45.5290663488068],
          [-73.4816247774588, 45.5293859122458],
          [-73.4820476018588, 45.5295614480522],
          [-73.4823752271562, 45.5297009740875],
          [-73.4831184827155, 45.5299980331437],
          [-73.4838289455017, 45.5302950827108],
          [-73.4852214979352, 45.5308846656821],
          [-73.4878174456701, 45.5319512806922],
          [-73.4885463522983, 45.5322662995512],
          [-73.4893060853432, 45.5325768174399],
          [-73.4899702043487, 45.5328558275632],
          [-73.4907399526105, 45.5331663367623],
          [-73.4909964006775, 45.5332698386617],
          [-73.4915589217841, 45.5335038395516],
          [-73.4925815425747, 45.5339268344802],
          [-73.4942395333052, 45.5346108070647],
          [-73.4954638473532, 45.5351192707071],
          [-73.4956278805713, 45.5352407552251],
          [-73.495882757383, 45.5353712411943],
          [-73.4966449642771, 45.5357267020868],
          [-73.4967701967667, 45.5357806959672],
          [-73.4972603357652, 45.5359876714745],
          [-73.4984590988822, 45.5364871038989],
          [-73.4994350133346, 45.5368965390487],
          [-73.5011423951153, 45.5376119056358],
          [-73.5034240293309, 45.5385656877622],
          [-73.50380817854, 45.5387276463325],
          [-73.5039118234, 45.5387861322597],
          [-73.5040951066119, 45.5389256006271],
          [-73.5045529059008, 45.5393170125315],
          [-73.5047469864998, 45.5394519802228],
          [-73.5048978470017, 45.5395329592075],
          [-73.5064685108748, 45.5401852630372],
          [-73.5070291530317, 45.5404056900123],
          [-73.5079575842235, 45.5407880598713],
          [-73.5080960415055, 45.5408465395506],
          [-73.508112044032, 45.5408195433039],
          [-73.5081588497922, 45.5407520521915],
          [-73.5082400744371, 45.5406332984627],
          [-73.5083588862285, 45.5404595906774],
          [-73.5088957812084, 45.5396811909796],
          [-73.5089905946579, 45.5395597055296],
          [-73.5095474770414, 45.538803797005],
          [-73.5100375322705, 45.5381288769299],
          [-73.5101807615215, 45.5379758918821],
          [-73.5102863795734, 45.537872401107],
          [-73.5104136049521, 45.5378049017659],
          [-73.5108045051954, 45.537570907701],
          [-73.5110801680935, 45.5374269072836],
          [-73.5117163012385, 45.5370579103883],
          [-73.5127401105147, 45.5364594087294],
          [-73.5131589607239, 45.5360814293857],
          [-73.5132723103776, 45.5360348298696],
          [-73.5134127336968, 45.535879433073],
          [-73.5137065865179, 45.5355832615546],
          [-73.5139406268333, 45.5353492492847],
          [-73.5140305922087, 45.5352625172904],
          [-73.5143124057127, 45.5349669071584],
          [-73.5147352816006, 45.5345400449285],
          [-73.5148424028896, 45.5344200745495],
          [-73.5148982577094, 45.5343574043554],
          [-73.5151451193309, 45.5340836042518],
          [-73.5153166291215, 45.5338969810514],
          [-73.5153719076583, 45.5338423894441],
          [-73.515503917482, 45.5336987880273],
          [-73.5158882267817, 45.5332870853369],
          [-73.5159862357293, 45.5331925886471],
          [-73.5167286415625, 45.5325490979504],
          [-73.5175786210618, 45.5318021044289],
          [-73.518114185339, 45.5312801144189],
          [-73.5182121684621, 45.5311676190186],
          [-73.5184497222979, 45.5308796325467],
          [-73.5186081097181, 45.5306951399353],
          [-73.5187132830289, 45.5305736445354],
          [-73.518834067755, 45.530429650496],
          [-73.5189528433472, 45.5302901558521],
          [-73.5190200167387, 45.5301686664594],
          [-73.5191675362048, 45.5298491990422],
          [-73.5193382449958, 45.5294712379685],
          [-73.5193952460027, 45.5291850885432],
          [-73.5194212277305, 45.5287918455218],
          [-73.5194329546679, 45.5268211958798],
          [-73.5194252573992, 45.5265512454033],
          [-73.5193914190343, 45.525871872435],
          [-73.5193801081706, 45.5255869689916],
          [-73.5194287404368, 45.5254940649033],
          [-73.5194286708491, 45.5251505934779],
          [-73.5194285362825, 45.5244770266803],
          [-73.5194546187454, 45.5241935574518],
          [-73.5194915255601, 45.5239541308116],
          [-73.5195514395557, 45.5236772434841],
          [-73.5196355774013, 45.5233731776881],
          [-73.520276656096, 45.5234061582024],
          [-73.5202495327026, 45.5236266237616],
          [-73.5202252078351, 45.5238695848036],
          [-73.5201980919899, 45.5240765527358],
          [-73.5201741876725, 45.5243870016475],
          [-73.5209214933703, 45.5244183616122],
          [-73.5209606912524, 45.5244183544265],
          [-73.5209738861505, 45.5244093536082],
          [-73.5209966837638, 45.5244048502219],
          [-73.5210226844689, 45.5243733510521],
          [-73.5210322527602, 45.5243018806519]
        ]
      }
    }]
  }
  const secondRouteGeoJSON = {
    "features": [
      {
        "geometry": {
          "coordinates": [
            [
              -73.5208106120734,
              45.5234269465577
            ],
            [
              -73.5213119659206,
              45.5234464625313
            ],
            [
              -73.5220910359548,
              45.5234805129381
            ],
            [
              -73.5221033131369,
              45.5233453708218
            ],
            [
              -73.5221287398972,
              45.5230608455409
            ],
            [
              -73.5222110721006,
              45.5221517428755
            ],
            [
              -73.5222272355899,
              45.5219757184264
            ],
            [
              -73.5222744253603,
              45.5214617862738
            ],
            [
              -73.5223025235798,
              45.5212462807782
            ],
            [
              -73.5223135438847,
              45.5211237293952
            ],
            [
              -73.522311797271,
              45.5210606662377
            ],
            [
              -73.5222968886803,
              45.5209901603715
            ],
            [
              -73.5222542494166,
              45.5209177324506
            ],
            [
              -73.5222018388468,
              45.5208727506388
            ],
            [
              -73.5220896594456,
              45.5208103315745
            ],
            [
              -73.522031665138,
              45.5207808271154
            ],
            [
              -73.5219616798546,
              45.5207625693361
            ],
            [
              -73.5218577058195,
              45.520745722673
            ],
            [
              -73.5217597356076,
              45.5207429302761
            ],
            [
              -73.5216777651081,
              45.5207541902644
            ],
            [
              -73.5216037934474,
              45.5207682588824
            ],
            [
              -73.5215118317326,
              45.5207921696947
            ],
            [
              -73.5213878794741,
              45.5208146808765
            ],
            [
              -73.5212859176843,
              45.5208315665264
            ],
            [
              -73.5212179418435,
              45.5208428226761
            ],
            [
              -73.5211399718015,
              45.5208554870856
            ],
            [
              -73.5210120143607,
              45.5208653486468
            ],
            [
              -73.5209180465337,
              45.5208723936447
            ],
            [
              -73.5207960853044,
              45.5208766325641
            ],
            [
              -73.5206401348857,
              45.5208780663989
            ],
            [
              -73.5204914007796,
              45.5208565357043
            ],
            [
              -73.5203633658653,
              45.5208400213365
            ],
            [
              -73.520252204579,
              45.5208372857875
            ],
            [
              -73.5201205698698,
              45.5208304666641
            ],
            [
              -73.5199258673798,
              45.5208146537065
            ],
            [
              -73.5198295389566,
              45.5208031444154
            ],
            [
              -73.5195221053797,
              45.5207527730224
            ],
            [
              -73.5194114261021,
              45.5207254187439
            ],
            [
              -73.5192056443166,
              45.5207293192405
            ],
            [
              -73.5163334647709,
              45.5198063661054
            ],
            [
              -73.5157103287959,
              45.5196061130402
            ],
            [
              -73.5156685545663,
              45.5195492425649
            ],
            [
              -73.5154527378499,
              45.5194701121017
            ],
            [
              -73.5153183239564,
              45.519429637386
            ],
            [
              -73.5145238361262,
              45.5191777858353
            ],
            [
              -73.5142533327536,
              45.5190901934416
            ],
            [
              -73.513884975702,
              45.5189619035577
            ],
            [
              -73.5138701776097,
              45.5189574061529
            ],
            [
              -73.5137765876028,
              45.5190294047185
            ],
            [
              -73.5136602230756,
              45.5191958891824
            ],
            [
              -73.5135410738824,
              45.5193893690663
            ],
            [
              -73.513476306899,
              45.5195063559814
            ],
            [
              -73.5134143418753,
              45.5196728337503
            ],
            [
              -73.5133415889319,
              45.5199068007684
            ],
            [
              -73.513327606565,
              45.5199967864356
            ],
            [
              -73.5133108559414,
              45.5201812556562
            ],
            [
              -73.513296901012,
              45.52038822055
            ],
            [
              -73.5133037447242,
              45.5205861846117
            ],
            [
              -73.5133102872152,
              45.5211350863758
            ],
            [
              -73.5133293898634,
              45.5224533498353
            ],
            [
              -73.5132245768633,
              45.5224038708197
            ],
            [
              -73.5129689329011,
              45.5223195131369
            ],
            [
              -73.5112755048939,
              45.5217606942238
            ],
            [
              -73.5102429698273,
              45.5214233514411
            ],
            [
              -73.5091672533457,
              45.5210590075737
            ],
            [
              -73.5091304435084,
              45.521009519312
            ],
            [
              -73.5090540322413,
              45.5209825301883
            ],
            [
              -73.5089140247556,
              45.5209375491899
            ],
            [
              -73.5087396115711,
              45.52090606826
            ],
            [
              -73.5086152011404,
              45.5208970793085
            ],
            [
              -73.5085187991381,
              45.5208925873373
            ],
            [
              -73.5085131924754,
              45.5208925877553
            ],
            [
              -73.5084119902644,
              45.5208880960515
            ],
            [
              -73.5083163953941,
              45.5208881030511
            ],
            [
              -73.5082251898178,
              45.5208791112526
            ],
            [
              -73.5080963735427,
              45.5208521252491
            ],
            [
              -73.5079043571259,
              45.5207981482843
            ],
            [
              -73.5078131536287,
              45.5208026537599
            ],
            [
              -73.5055253746753,
              45.5200649183029
            ],
            [
              -73.5022348325806,
              45.5189897207729
            ],
            [
              -73.4999724031935,
              45.5182608717767
            ],
            [
              -73.4988200143028,
              45.5178694350033
            ],
            [
              -73.4977336228676,
              45.5175184807393
            ],
            [
              -73.4938814172986,
              45.5162720598029
            ],
            [
              -73.4908380755824,
              45.5152775319357
            ],
            [
              -73.4877296591831,
              45.5142649190179
            ],
            [
              -73.4846633565101,
              45.5132657246179
            ],
            [
              -73.4815803449614,
              45.5122664450408
            ],
            [
              -73.4785110600705,
              45.5112670846629
            ],
            [
              -73.475432671105,
              45.5102631404734
            ],
            [
              -73.4721384765673,
              45.5091825741412
            ],
            [
              -73.4711444000468,
              45.5088493857861
            ],
            [
              -73.47099724536,
              45.5088088556241
            ],
            [
              -73.4709320218641,
              45.5088943240459
            ],
            [
              -73.4706937537646,
              45.509214405381
            ],
            [
              -73.4703661102245,
              45.5096545451644
            ],
            [
              -73.4695896542002,
              45.5107206537461
            ],
            [
              -73.4694343750624,
              45.5109050798714
            ],
            [
              -73.4689845617617,
              45.5113998715863
            ],
            [
              -73.4684149923034,
              45.5121780785429
            ],
            [
              -73.4664191892423,
              45.5149085278186
            ],
            [
              -73.4659200109853,
              45.5155787616024
            ],
            [
              -73.4638891349659,
              45.5183541466054
            ],
            [
              -73.4637169576698,
              45.51861954502
            ],
            [
              -73.4636308159978,
              45.5188534761687
            ],
            [
              -73.463583064277,
              45.5190829202853
            ],
            [
              -73.4635637594563,
              45.5192448854155
            ],
            [
              -73.4635828030618,
              45.5194878484085
            ],
            [
              -73.4637024816698,
              45.519991797116
            ],
            [
              -73.4637938331146,
              45.5203787574425
            ],
            [
              -73.4639238964958,
              45.5209232019391
            ],
            [
              -73.4641112426463,
              45.5217059239068
            ],
            [
              -73.4641856024256,
              45.5220165900269
            ],
            [
              -73.4642151337851,
              45.5221380776841
            ],
            [
              -73.464330855321,
              45.5226015314616
            ],
            [
              -73.4644234142933,
              45.522974993886
            ],
            [
              -73.4649301353126,
              45.5251122698764
            ],
            [
              -73.4649759933342,
              45.5253552406155
            ],
            [
              -73.4650026085529,
              45.5256431974048
            ],
            [
              -73.4649913066198,
              45.5258051650409
            ],
            [
              -73.4649648368755,
              45.52592213605
            ],
            [
              -73.4648862946693,
              45.5261335741913
            ],
            [
              -73.4647312814964,
              45.5264349726198
            ],
            [
              -73.4626235757838,
              45.5303710981319
            ],
            [
              -73.462436507876,
              45.5307084762758
            ],
            [
              -73.4623579885411,
              45.5308614229979
            ],
            [
              -73.4621696717146,
              45.531261788964
            ],
            [
              -73.4619381608277,
              45.5316531418227
            ],
            [
              -73.4615937392796,
              45.5321524368915
            ],
            [
              -73.4614327861673,
              45.5323278511542
            ],
            [
              -73.4608902736514,
              45.5328675697163
            ],
            [
              -73.4607565387954,
              45.5330024995967
            ],
            [
              -73.4596287523329,
              45.5339739318628
            ],
            [
              -73.4589625776061,
              45.5345090981536
            ],
            [
              -73.4587311697157,
              45.5346934815855
            ],
            [
              -73.4582411003079,
              45.5351522208614
            ],
            [
              -73.4579864365494,
              45.5354040821038
            ],
            [
              -73.4577813992717,
              45.5356379643618
            ],
            [
              -73.4573424288669,
              45.5362136974929
            ],
            [
              -73.4571300952041,
              45.5365555563521
            ],
            [
              -73.4569482127096,
              45.5368569335809
            ],
            [
              -73.456810743868,
              45.5371448297401
            ],
            [
              -73.4566644355634,
              45.5374867126215
            ],
            [
              -73.4564851584852,
              45.5380220478058
            ],
            [
              -73.456445050693,
              45.5381435105813
            ],
            [
              -73.4563567203566,
              45.5385304069705
            ],
            [
              -73.45622120943,
              45.5393717030392
            ],
            [
              -73.4561439050073,
              45.5399835627063
            ],
            [
              -73.4560763848711,
              45.5403614683698
            ],
            [
              -73.4559156282823,
              45.5412657426846
            ],
            [
              -73.4558343626979,
              45.5418101126429
            ],
            [
              -73.4557016320822,
              45.5426784037881
            ],
            [
              -73.4552822521451,
              45.5426602436539
            ],
            [
              -73.4551657541993,
              45.5427321849313
            ],
            [
              -73.4547848058854,
              45.5430001879283
            ],
            [
              -73.4537723467036,
              45.5437124515288
            ],
            [
              -73.4524914311762,
              45.5445847674268
            ],
            [
              -73.4512529067547,
              45.5454525877444
            ],
            [
              -73.4505997951092,
              45.5459022253197
            ],
            [
              -73.4499683021797,
              45.5463383710533
            ],
            [
              -73.4497360383835,
              45.5465047387831
            ],
            [
              -73.4492707282005,
              45.5468059782004
            ],
            [
              -73.4491033525784,
              45.5469138840817
            ],
            [
              -73.4488310797604,
              45.5470622354008
            ],
            [
              -73.4485427931969,
              45.5472150780349
            ],
            [
              -73.4483385996947,
              45.5473049694769
            ],
            [
              -73.448002302314,
              45.547439792298
            ],
            [
              -73.4479470611391,
              45.5474603913811
            ],
            [
              -73.4476287830256,
              45.5475790962475
            ],
            [
              -73.4470218777889,
              45.5477812794916
            ],
            [
              -73.4466571690634,
              45.5479025876229
            ],
            [
              -73.4454167945699,
              45.5483040573669
            ],
            [
              -73.4447619175073,
              45.5485135753026
            ],
            [
              -73.4440204947462,
              45.5487534345536
            ],
            [
              -73.4433040346995,
              45.548985112869
            ],
            [
              -73.4427880548156,
              45.5491526866833
            ],
            [
              -73.4425675942846,
              45.5492249651432
            ],
            [
              -73.4419124117733,
              45.5494355787533
            ],
            [
              -73.4418261540555,
              45.5494636403273
            ],
            [
              -73.4410880386208,
              45.5497011516159
            ],
            [
              -73.4410221164425,
              45.5497231932683
            ],
            [
              -73.4403316080985,
              45.5499456492815
            ],
            [
              -73.4401587868573,
              45.5500020883538
            ],
            [
              -73.4396434061482,
              45.5501679790534
            ],
            [
              -73.4392797324107,
              45.5502981185097
            ],
            [
              -73.4391520718691,
              45.5503434112923
            ],
            [
              -73.4389784234739,
              45.5504092856094
            ],
            [
              -73.4387998354858,
              45.5504946744483
            ],
            [
              -73.4385879972371,
              45.5505935426691
            ],
            [
              -73.4383078482223,
              45.5507503896183
            ],
            [
              -73.4383078430964,
              45.550750392315
            ],
            [
              -73.4380553529174,
              45.5509081975018
            ],
            [
              -73.4376953980571,
              45.5511678436283
            ],
            [
              -73.4373559277615,
              45.5514612148758
            ],
            [
              -73.4370967090895,
              45.5517085271545
            ],
            [
              -73.4361546890075,
              45.5526438332223
            ],
            [
              -73.4355472407427,
              45.5532373833018
            ],
            [
              -73.4353276726815,
              45.5534397221009
            ],
            [
              -73.4351590001797,
              45.5535880992687
            ],
            [
              -73.4350207873783,
              45.5537005001131
            ],
            [
              -73.4348489140588,
              45.5538353774706
            ],
            [
              -73.4346490361985,
              45.5539747377241
            ],
            [
              -73.4344828024826,
              45.5540826227017
            ],
            [
              -73.4342557031939,
              45.5542129682961
            ],
            [
              -73.4329993051377,
              45.5548871144757
            ],
            [
              -73.4325431102171,
              45.5551343005742
            ],
            [
              -73.4324597911851,
              45.5551882414308
            ],
            [
              -73.4322230440137,
              45.5553455722974
            ],
            [
              -73.4317887726438,
              45.5556647551465
            ],
            [
              -73.4313055659886,
              45.5560693912027
            ],
            [
              -73.430708430429,
              45.5566629213972
            ],
            [
              -73.4293129968547,
              45.5580118181221
            ],
            [
              -73.4290284335895,
              45.5582950894955
            ],
            [
              -73.4283896733358,
              45.5588570872731
            ],
            [
              -73.4278366312376,
              45.5593606463864
            ],
            [
              -73.425955910455,
              45.5610016398928
            ],
            [
              -73.4251535656636,
              45.5617029873963
            ],
            [
              -73.4244342860063,
              45.5622424140963
            ],
            [
              -73.4240876984266,
              45.562480640226
            ],
            [
              -73.4238969913037,
              45.5625974917095
            ],
            [
              -73.422141875484,
              45.563568129211
            ],
            [
              -73.4215489117799,
              45.5639186585762
            ],
            [
              -73.421220407463,
              45.5640894008508
            ],
            [
              -73.4208935150896,
              45.5642511449583
            ],
            [
              -73.4205253458819,
              45.5644398544168
            ],
            [
              -73.4195509728651,
              45.5649835715238
            ],
            [
              -73.415451773579,
              45.5672526896736
            ],
            [
              -73.4156188893561,
              45.5674102839888
            ],
            [
              -73.4161629972698,
              45.567923589306
            ],
            [
              -73.4163257099367,
              45.5680811793371
            ],
            [
              -73.416469273722,
              45.5681847651679
            ],
            [
              -73.4166240607751,
              45.5682883590082
            ],
            [
              -73.4168672905396,
              45.5684145128505
            ],
            [
              -73.4170058465447,
              45.5684783271507
            ],
            [
              -73.4170825425697,
              45.5685136508877
            ],
            [
              -73.4173230412373,
              45.5685903109755
            ],
            [
              -73.41755234372,
              45.5686579641492
            ],
            [
              -73.4178177181596,
              45.5687031470016
            ],
            [
              -73.4180859055412,
              45.5687348337644
            ],
            [
              -73.4183705566143,
              45.5687395366836
            ],
            [
              -73.4188710426875,
              45.5687173974002
            ],
            [
              -73.4200489715506,
              45.5686597387492
            ],
            [
              -73.424112516394,
              45.5684330531025
            ],
            [
              -73.4254181743809,
              45.5683574272103
            ],
            [
              -73.4257845134595,
              45.5683396691409
            ],
            [
              -73.4260768026612,
              45.5683218620025
            ],
            [
              -73.4263530716074,
              45.5683085429529
            ],
            [
              -73.4267178086586,
              45.5682907808575
            ],
            [
              -73.4270353228567,
              45.5682729874454
            ],
            [
              -73.4273099655039,
              45.5682686633699
            ],
            [
              -73.4281567186156,
              45.5682691990297
            ],
            [
              -73.4285702645812,
              45.5682829558502
            ],
            [
              -73.4288689000486,
              45.5683011388444
            ],
            [
              -73.4290870917043,
              45.5683102728233
            ],
            [
              -73.4296543408165,
              45.5683511160089
            ],
            [
              -73.4307151428698,
              45.5684597442367
            ],
            [
              -73.4310982161119,
              45.568522964217
            ],
            [
              -73.4320404533657,
              45.5686854985202
            ],
            [
              -73.4345652820838,
              45.5692268722058
            ],
            [
              -73.4391611798538,
              45.5702102296902
            ],
            [
              -73.4395038131394,
              45.5702868974057
            ],
            [
              -73.4397043514791,
              45.570327495886
            ],
            [
              -73.4398952956346,
              45.5703545914806
            ],
            [
              -73.4400862862707,
              45.570350192647
            ],
            [
              -73.4402416630167,
              45.570318779898
            ],
            [
              -73.4404671420887,
              45.5702424118718
            ],
            [
              -73.4406550349927,
              45.5701255314214
            ],
            [
              -73.4408877999147,
              45.5699906772386
            ],
            [
              -73.4410929241606,
              45.5698603074909
            ],
            [
              -73.4413721632783,
              45.5696804846459
            ],
            [
              -73.4414807307256,
              45.5696175520378
            ],
            [
              -73.4415924926924,
              45.5695501217966
            ],
            [
              -73.441739106665,
              45.5694782100625
            ],
            [
              -73.4419225315523,
              45.5694153151851
            ],
            [
              -73.4419980088582,
              45.5693989135921
            ],
            [
              -73.44221166451,
              45.5693524735354
            ],
            [
              -73.4425268125579,
              45.5692941434072
            ],
            [
              -73.4430445728733,
              45.5691999203032
            ],
            [
              -73.4433220879286,
              45.5691325708848
            ],
            [
              -73.4435379757722,
              45.5690426945338
            ],
            [
              -73.443676583247,
              45.5689662771863
            ],
            [
              -73.4438320131166,
              45.5688628729635
            ],
            [
              -73.4439765880746,
              45.5688269506518
            ],
            [
              -73.4440450704771,
              45.5688089875635
            ],
            [
              -73.4440959197915,
              45.5687955149695
            ],
            [
              -73.4441732119493,
              45.5687820552783
            ],
            [
              -73.4442564781232,
              45.5687775967765
            ],
            [
              -73.4443457612292,
              45.5687776403086
            ],
            [
              -73.4444354281827,
              45.5687911814471
            ],
            [
              -73.4445066806635,
              45.5688092127345
            ],
            [
              -73.4446079239473,
              45.5688542535023
            ],
            [
              -73.4447187980806,
              45.5688768030255
            ],
            [
              -73.4451580834453,
              45.5692009544918
            ],
            [
              -73.445831790258,
              45.5697231787972
            ],
            [
              -73.4459798024677,
              45.5698447262688
            ],
            [
              -73.4460790286365,
              45.5699122605821
            ],
            [
              -73.4461942911968,
              45.5699573065515
            ],
            [
              -73.4463111682691,
              45.5699888556764
            ],
            [
              -73.4463996290398,
              45.5700068938656
            ],
            [
              -73.4479451774313,
              45.5703090524459
            ],
            [
              -73.4481769567726,
              45.5703361527982
            ],
            [
              -73.4484939958856,
              45.5703947852863
            ],
            [
              -73.4490488050394,
              45.5705165114553
            ],
            [
              -73.4492233423385,
              45.5705435841385
            ],
            [
              -73.4492642547791,
              45.5704536190802
            ],
            [
              -73.4495426650351,
              45.5698143394715
            ],
            [
              -73.4497216209806,
              45.5694100156524
            ],
            [
              -73.4499470700506,
              45.5689017092524
            ],
            [
              -73.4499815584313,
              45.5688297377489
            ],
            [
              -73.4500509616936,
              45.5686812957311
            ],
            [
              -73.4500549668393,
              45.5686722991558
            ],
            [
              -73.450056572257,
              45.5686678006944
            ],
            [
              -73.4500585748291,
              45.5686633024067
            ],
            [
              -73.4500605902123,
              45.5686588041245
            ],
            [
              -73.4500625927838,
              45.5686543058367
            ],
            [
              -73.4500645953549,
              45.5686498075488
            ],
            [
              -73.4500666107372,
              45.5686453092665
            ],
            [
              -73.4500686133077,
              45.5686408109785
            ],
            [
              -73.4500706158778,
              45.5686363126905
            ],
            [
              -73.4500722212932,
              45.5686318142289
            ],
            [
              -73.4500742238628,
              45.5686273159409
            ],
            [
              -73.450076226432,
              45.5686228176528
            ],
            [
              -73.4500782418124,
              45.5686183193702
            ],
            [
              -73.4500802403956,
              45.5686183202436
            ],
            [
              -73.4500818458097,
              45.5686138217819
            ],
            [
              -73.4500838483779,
              45.5686093234936
            ],
            [
              -73.4500858509457,
              45.5686048252053
            ],
            [
              -73.450087456359,
              45.5686003267435
            ],
            [
              -73.4500894717377,
              45.5685958284607
            ],
            [
              -73.4500914743046,
              45.5685913301723
            ],
            [
              -73.450093079717,
              45.5685868317104
            ],
            [
              -73.4500950822833,
              45.5685823334219
            ],
            [
              -73.4500970848493,
              45.5685778351334
            ],
            [
              -73.4500986902609,
              45.5685733366714
            ],
            [
              -73.4501007056377,
              45.5685688383884
            ],
            [
              -73.4501023110488,
              45.5685643399264
            ],
            [
              -73.4501043136136,
              45.5685598416377
            ],
            [
              -73.450106316178,
              45.568555343349
            ],
            [
              -73.4501079215882,
              45.5685508448869
            ],
            [
              -73.4501099241521,
              45.5685463465981
            ],
            [
              -73.4501115295618,
              45.5685418481359
            ],
            [
              -73.4501135449364,
              45.5685373498526
            ],
            [
              -73.4501151503455,
              45.5685328513904
            ],
            [
              -73.4501167557544,
              45.568528352928
            ],
            [
              -73.4501187583168,
              45.5685238546391
            ],
            [
              -73.4501203637251,
              45.5685193561767
            ],
            [
              -73.4501223623048,
              45.5685193570494
            ],
            [
              -73.4501239677127,
              45.5685148585869
            ],
            [
              -73.450125970274,
              45.5685103602979
            ],
            [
              -73.4501275756814,
              45.5685058618354
            ],
            [
              -73.4501291938999,
              45.5685013633785
            ],
            [
              -73.4501311964603,
              45.5684968650893
            ],
            [
              -73.4501328018669,
              45.5684923666267
            ],
            [
              -73.4501344072732,
              45.5684878681641
            ],
            [
              -73.4501360126793,
              45.5684833697015
            ],
            [
              -73.4501380152385,
              45.5684788714122
            ],
            [
              -73.450139620644,
              45.5684743729495
            ],
            [
              -73.4501412260493,
              45.5684698744868
            ],
            [
              -73.4501428314543,
              45.5684653760241
            ],
            [
              -73.4501448340123,
              45.5684608777347
            ],
            [
              -73.4501464394168,
              45.5684563792719
            ],
            [
              -73.450148044821,
              45.5684518808091
            ],
            [
              -73.4501496502249,
              45.5684473823462
            ],
            [
              -73.4501512556286,
              45.5684428838833
            ],
            [
              -73.4501528610321,
              45.5684383854204
            ],
            [
              -73.4501544664353,
              45.5684338869575
            ],
            [
              -73.4501564818026,
              45.5684293886734
            ],
            [
              -73.4501580872052,
              45.5684248902105
            ],
            [
              -73.4501596926076,
              45.5684203917475
            ],
            [
              -73.4501612851983,
              45.5684158932788
            ],
            [
              -73.4501628906002,
              45.5684113948158
            ],
            [
              -73.4501644960018,
              45.5684068963527
            ],
            [
              -73.4501661014032,
              45.5684023978896
            ],
            [
              -73.4501677196157,
              45.568397899432
            ],
            [
              -73.4501693250165,
              45.5683934009689
            ],
            [
              -73.450170926439,
              45.5683934016674
            ],
            [
              -73.4501725318394,
              45.5683889032042
            ],
            [
              -73.4501741244283,
              45.5683844047354
            ],
            [
              -73.4501753326755,
              45.5683799060989
            ],
            [
              -73.4501769380753,
              45.5683754076356
            ],
            [
              -73.4501785434747,
              45.5683709091723
            ],
            [
              -73.4501801488739,
              45.5683664107089
            ],
            [
              -73.4501817542729,
              45.5683619122456
            ],
            [
              -73.4501833596716,
              45.5683574137822
            ],
            [
              -73.45018496507,
              45.5683529153188
            ],
            [
              -73.4501861733157,
              45.5683484166821
            ],
            [
              -73.4501877787137,
              45.5683439182187
            ],
            [
              -73.4501893841114,
              45.5683394197552
            ],
            [
              -73.4501909895088,
              45.5683349212917
            ],
            [
              -73.4501921977537,
              45.568330422655
            ],
            [
              -73.4501938031507,
              45.5683259241914
            ],
            [
              -73.4501954085474,
              45.5683214257278
            ],
            [
              -73.4501970139438,
              45.5683169272642
            ],
            [
              -73.4501982221878,
              45.5683124286274
            ],
            [
              -73.4501998147724,
              45.5683079301582
            ],
            [
              -73.4502014201681,
              45.5683034316945
            ],
            [
              -73.4502026284115,
              45.5682989330576
            ],
            [
              -73.4502042338067,
              45.5682944345939
            ],
            [
              -73.4502054420496,
              45.568289935957
            ],
            [
              -73.4502070474444,
              45.5682854374932
            ],
            [
              -73.4502082556869,
              45.5682809388563
            ],
            [
              -73.4502098610811,
              45.5682764403925
            ],
            [
              -73.4502114664752,
              45.5682719419286
            ],
            [
              -73.4502126619057,
              45.5682674432861
            ],
            [
              -73.4502142672992,
              45.5682629448222
            ],
            [
              -73.4502154755407,
              45.5682584461852
            ],
            [
              -73.4502170809337,
              45.5682539477212
            ],
            [
              -73.4502182891747,
              45.5682494490842
            ],
            [
              -73.4502194974156,
              45.5682449504471
            ],
            [
              -73.4502211028079,
              45.5682404519831
            ],
            [
              -73.4502223110484,
              45.568235953346
            ],
            [
              -73.4502239164402,
              45.5682314548819
            ],
            [
              -73.4502251118689,
              45.5682269562392
            ],
            [
              -73.450226316135,
              45.5682269567639
            ],
            [
              -73.4502279215263,
              45.5682224582998
            ],
            [
              -73.4502291297658,
              45.5682179596626
            ],
            [
              -73.4502303251937,
              45.5682134610198
            ],
            [
              -73.4502319433957,
              45.5682089625612
            ],
            [
              -73.4502331388232,
              45.5682044639184
            ],
            [
              -73.4502343470619,
              45.5681999652812
            ],
            [
              -73.4502355553004,
              45.5681954666439
            ],
            [
              -73.45023716069,
              45.5681909681796
            ],
            [
              -73.4502383561168,
              45.5681864695367
            ],
            [
              -73.4502395643547,
              45.5681819708994
            ],
            [
              -73.4502407725924,
              45.5681774722621
            ],
            [
              -73.4502419808298,
              45.5681729736247
            ],
            [
              -73.4502435862183,
              45.5681684751603
            ],
            [
              -73.4502447944554,
              45.5681639765229
            ],
            [
              -73.450245989881,
              45.5681594778799
            ],
            [
              -73.4502471981177,
              45.5681549792425
            ],
            [
              -73.4502484063542,
              45.568150480605
            ],
            [
              -73.4502496145905,
              45.5681459819676
            ],
            [
              -73.4502508100153,
              45.5681414833245
            ],
            [
              -73.4502520182512,
              45.568136984687
            ],
            [
              -73.4502532264869,
              45.5681324860495
            ],
            [
              -73.4502544219112,
              45.5681279874064
            ],
            [
              -73.4502556301465,
              45.5681234887689
            ],
            [
              -73.4502568383816,
              45.5681189901313
            ],
            [
              -73.4502580466166,
              45.5681144914938
            ],
            [
              -73.4502592548514,
              45.5681099928562
            ],
            [
              -73.4502604502746,
              45.568105494213
            ],
            [
              -73.450261658509,
              45.5681009955754
            ],
            [
              -73.4502628667432,
              45.5680964969377
            ],
            [
              -73.4502640621659,
              45.5680919982945
            ],
            [
              -73.4502652703997,
              45.5680874996568
            ],
            [
              -73.4502664786333,
              45.5680830010191
            ],
            [
              -73.4502672769048,
              45.5680785022029
            ],
            [
              -73.4502684851381,
              45.5680740035652
            ],
            [
              -73.4502696933711,
              45.5680695049275
            ],
            [
              -73.450270901604,
              45.5680650062897
            ],
            [
              -73.4502721098367,
              45.568060507652
            ],
            [
              -73.4502729081075,
              45.5680560088357
            ],
            [
              -73.4502741163398,
              45.5680515101979
            ],
            [
              -73.4502753245719,
              45.5680470115601
            ],
            [
              -73.4502765199925,
              45.5680425129167
            ],
            [
              -73.450277331074,
              45.568038014106
            ],
            [
              -73.4502785264943,
              45.5680335154626
            ],
            [
              -73.4502797347257,
              45.5680290168247
            ],
            [
              -73.4502805458067,
              45.568024518014
            ],
            [
              -73.4502817412264,
              45.5680200193705
            ],
            [
              -73.4502825523072,
              45.5680155205597
            ],
            [
              -73.4502837605378,
              45.5680110219218
            ],
            [
              -73.4502849687683,
              45.5680065232839
            ],
            [
              -73.4502857670373,
              45.5680020244675
            ],
            [
              -73.4502869752674,
              45.5679975258295
            ],
            [
              -73.4502877735361,
              45.5679930270131
            ],
            [
              -73.4502889817659,
              45.5679885283751
            ],
            [
              -73.4502897800343,
              45.5679840295587
            ],
            [
              -73.4502909882638,
              45.5679795309207
            ],
            [
              -73.4502917993432,
              45.5679750321098
            ],
            [
              -73.450292994761,
              45.5679705334662
            ],
            [
              -73.4502938058401,
              45.5679660346553
            ],
            [
              -73.4502950140688,
              45.5679615360172
            ],
            [
              -73.4502958123363,
              45.5679570372007
            ],
            [
              -73.450296619447,
              45.5679570375519
            ],
            [
              -73.4502978276753,
              45.5679525389138
            ],
            [
              -73.4502986259425,
              45.5679480400973
            ],
            [
              -73.4502998341705,
              45.5679435414591
            ],
            [
              -73.4503006324374,
              45.5679390426426
            ],
            [
              -73.4503014435154,
              45.5679345438316
            ],
            [
              -73.4503022417821,
              45.5679300450151
            ],
            [
              -73.4503034500093,
              45.5679255463769
            ],
            [
              -73.4503042482757,
              45.5679210475603
            ],
            [
              -73.4503050593532,
              45.5679165487493
            ],
            [
              -73.4503062675799,
              45.567912050111
            ],
            [
              -73.4503070658459,
              45.5679075512945
            ],
            [
              -73.450307876923,
              45.5679030524834
            ],
            [
              -73.4503086751887,
              45.5678985536668
            ],
            [
              -73.4503094862655,
              45.5678940548558
            ],
            [
              -73.4503102845309,
              45.5678895560391
            ],
            [
              -73.4503114927567,
              45.5678850574008
            ],
            [
              -73.4503123038331,
              45.5678805585897
            ],
            [
              -73.4503131020981,
              45.567876059773
            ],
            [
              -73.4503139131742,
              45.567871560962
            ],
            [
              -73.450314711439,
              45.5678670621453
            ],
            [
              -73.4503155097036,
              45.5678625633286
            ],
            [
              -73.4503163207794,
              45.5678580645174
            ],
            [
              -73.4503171190437,
              45.5678535657007
            ],
            [
              -73.4503179301192,
              45.5678490668896
            ],
            [
              -73.4503187283833,
              45.5678445680729
            ],
            [
              -73.4503195394586,
              45.5678400692617
            ],
            [
              -73.4503203377224,
              45.567835570445
            ],
            [
              -73.4503211487974,
              45.5678310716338
            ],
            [
              -73.4503219598723,
              45.5678265728226
            ],
            [
              -73.4503227581357,
              45.5678220740058
            ],
            [
              -73.4503235692103,
              45.5678175751946
            ],
            [
              -73.4503243674735,
              45.5678130763778
            ],
            [
              -73.4503251785479,
              45.5678085775666
            ],
            [
              -73.4503255796622,
              45.5678040785771
            ],
            [
              -73.4503263779251,
              45.5677995797602
            ],
            [
              -73.4503271889991,
              45.567795080949
            ],
            [
              -73.4503279872617,
              45.5677905821321
            ],
            [
              -73.4503287983354,
              45.5677860833209
            ],
            [
              -73.4503291994493,
              45.5677815843313
            ],
            [
              -73.4503299977115,
              45.5677770855145
            ],
            [
              -73.4503308087849,
              45.5677725867032
            ],
            [
              -73.4503316070469,
              45.5677680878863
            ],
            [
              -73.4503320209717,
              45.5677635889023
            ],
            [
              -73.4503328192335,
              45.5677590900854
            ],
            [
              -73.4503336303063,
              45.5677545912741
            ],
            [
              -73.4503340314196,
              45.5677500922845
            ],
            [
              -73.4503348424923,
              45.5677455934731
            ],
            [
              -73.4503356407535,
              45.5677410946562
            ],
            [
              -73.4503360418666,
              45.5677365956666
            ],
            [
              -73.4503368529389,
              45.5677320968552
            ],
            [
              -73.4503372540517,
              45.5677275978656
            ],
            [
              -73.4503380651238,
              45.5677230990542
            ],
            [
              -73.4503388633845,
              45.5677186002373
            ],
            [
              -73.4503392644971,
              45.5677141012476
            ],
            [
              -73.4503400755688,
              45.5677096024362
            ],
            [
              -73.4503404766812,
              45.5677051034466
            ],
            [
              -73.4503412749415,
              45.5677006046296
            ],
            [
              -73.450341688865,
              45.5676961056455
            ],
            [
              -73.4503424871251,
              45.5676916068285
            ],
            [
              -73.4503428882372,
              45.5676871078388
            ],
            [
              -73.4503433021604,
              45.5676826088547
            ],
            [
              -73.4503441004202,
              45.5676781100377
            ],
            [
              -73.450344501532,
              45.567673611048
            ],
            [
              -73.4503453126028,
              45.5676691122365
            ],
            [
              -73.4503457137145,
              45.5676646132468
            ],
            [
              -73.4503461276374,
              45.5676601142627
            ],
            [
              -73.4503469258965,
              45.5676556154456
            ],
            [
              -73.450347327008,
              45.5676511164559
            ],
            [
              -73.4503477409307,
              45.5676466174718
            ],
            [
              -73.4503481420421,
              45.5676421184821
            ],
            [
              -73.4503489403008,
              45.567637619665
            ],
            [
              -73.4503493542232,
              45.5676331206808
            ],
            [
              -73.4503497553344,
              45.5676286216911
            ],
            [
              -73.4503501564455,
              45.5676241227014
            ],
            [
              -73.450350967515,
              45.5676196238898
            ],
            [
              -73.4503513686259,
              45.5676151249
            ],
            [
              -73.4503517697368,
              45.5676106259103
            ],
            [
              -73.4503521708476,
              45.5676061269205
            ],
            [
              -73.4503525847695,
              45.5676016279363
            ],
            [
              -73.4503529858802,
              45.5675971289466
            ],
            [
              -73.4503533869908,
              45.5675926299568
            ],
            [
              -73.4503541852484,
              45.5675881311396
            ],
            [
              -73.4503545991701,
              45.5675836321554
            ],
            [
              -73.4503550002804,
              45.5675791331656
            ],
            [
              -73.4503554013907,
              45.5675746341758
            ],
            [
              -73.450355802501,
              45.567570135186
            ],
            [
              -73.4503562164224,
              45.5675656362018
            ],
            [
              -73.4503566175325,
              45.567561137212
            ],
            [
              -73.4503570186425,
              45.5675566382222
            ],
            [
              -73.4503574197525,
              45.5675521392323
            ],
            [
              -73.4503598322189,
              45.5675476411165
            ],
            [
              -73.4507061117549,
              45.5675702868839
            ],
            [
              -73.4514884568567,
              45.5677356592277
            ],
            [
              -73.4516871948453,
              45.5677776675602
            ],
            [
              -73.4532166648954,
              45.5681022439572
            ],
            [
              -73.4533567801551,
              45.5681202979073
            ],
            [
              -73.4534737057212,
              45.5680933506065
            ],
            [
              -73.4535722122239,
              45.5680618965377
            ],
            [
              -73.4536266972923,
              45.568016927031
            ],
            [
              -73.4554012053829,
              45.5663304469355
            ],
            [
              -73.4557978117958,
              45.5659796661975
            ],
            [
              -73.456219634148,
              45.5656333928931
            ],
            [
              -73.4566586723235,
              45.5652826253773
            ],
            [
              -73.4569350601441,
              45.5650847666008
            ],
            [
              -73.4571517495104,
              45.5649363756007
            ],
            [
              -73.4579328253007,
              45.5643517742649
            ],
            [
              -73.4583514392149,
              45.5639964934746
            ],
            [
              -73.4593332478786,
              45.56315100376
            ],
            [
              -73.4596136480826,
              45.5629036490117
            ],
            [
              -73.459937292628,
              45.5626383120664
            ],
            [
              -73.4603646435261,
              45.562319020202
            ],
            [
              -73.4606770505104,
              45.5620851714134
            ],
            [
              -73.4607211318679,
              45.5620266973887
            ],
            [
              -73.4607359746257,
              45.5619772116377
            ],
            [
              -73.4607348081014,
              45.5619232212142
            ],
            [
              -73.4607314028431,
              45.5616442715856
            ],
            [
              -73.4616789528212,
              45.5616175983626
            ],
            [
              -73.4619775788865,
              45.561613198979
            ],
            [
              -73.4620696590493,
              45.5616087304211
            ],
            [
              -73.4621653357424,
              45.561608762149
            ],
            [
              -73.4623899080456,
              45.561604337137
            ],
            [
              -73.4624619633888,
              45.5616043608372
            ],
            [
              -73.4630356125846,
              45.5615865512229
            ],
            [
              -73.4634587546568,
              45.561555193177
            ],
            [
              -73.4638510787159,
              45.5615193246469
            ],
            [
              -73.4641585429963,
              45.5614744298382
            ],
            [
              -73.4643831530051,
              45.5614295083991
            ],
            [
              -73.4646345607352,
              45.5613845948173
            ],
            [
              -73.4649428362701,
              45.5613306998097
            ],
            [
              -73.4652975504223,
              45.5612498230717
            ],
            [
              -73.4656062354152,
              45.5611734305512
            ],
            [
              -73.4659925911189,
              45.5610655661596
            ],
            [
              -73.4663841642554,
              45.560948703656
            ],
            [
              -73.4666924548276,
              45.5608408138944
            ],
            [
              -73.4669699317599,
              45.5607419127327
            ],
            [
              -73.4672614216996,
              45.5606205190641
            ],
            [
              -73.4675248778209,
              45.5605081150224
            ],
            [
              -73.4678155788704,
              45.5603732222012
            ],
            [
              -73.4679785445219,
              45.560278785432
            ],
            [
              -73.4681166849559,
              45.5602293332018
            ],
            [
              -73.4682347935999,
              45.5601753760659
            ],
            [
              -73.468563147817,
              45.5599775034173
            ],
            [
              -73.4688779035714,
              45.5597661286033
            ],
            [
              -73.4689876199195,
              45.5596896725463
            ],
            [
              -73.4695670597001,
              45.559298400549
            ],
            [
              -73.4698549804803,
              45.5590960142073
            ],
            [
              -73.4700744180411,
              45.5589475992643
            ],
            [
              -73.4702705957726,
              45.5588666654101
            ],
            [
              -73.4703767029917,
              45.5588262004358
            ],
            [
              -73.4705556431662,
              45.5587857541587
            ],
            [
              -73.4706769428362,
              45.5587677886751
            ],
            [
              -73.4707802257101,
              45.5587633159689
            ],
            [
              -73.4708963026291,
              45.5587633456006
            ],
            [
              -73.4710756244247,
              45.5587768886585
            ],
            [
              -73.4712561389015,
              45.5588129275902
            ],
            [
              -73.4714462422888,
              45.5588849620014
            ],
            [
              -73.4716415421864,
              45.5589659957272
            ],
            [
              -73.4721613272004,
              45.5593575514332
            ],
            [
              -73.472928009247,
              45.5599336295027
            ],
            [
              -73.4731728665753,
              45.5601207420622
            ],
            [
              -73.4742237075354,
              45.5609237465558
            ],
            [
              -73.4751108793759,
              45.561594319486
            ],
            [
              -73.475817996142,
              45.562129872424
            ],
            [
              -73.4727118332359,
              45.564095308918
            ],
            [
              -73.4709398105911,
              45.5652331609803
            ],
            [
              -73.4700755887874,
              45.5657908344147
            ],
            [
              -73.4681424635332,
              45.5670185837234
            ],
            [
              -73.4653357350663,
              45.5688129328883
            ],
            [
              -73.4646616730021,
              45.5692401468406
            ],
            [
              -73.4644213295447,
              45.5694200387476
            ],
            [
              -73.4643444171513,
              45.5694875022067
            ],
            [
              -73.464295925065,
              45.569568471987
            ],
            [
              -73.463994397113,
              45.5702792449816
            ],
            [
              -73.4635906379397,
              45.5711834484911
            ],
            [
              -73.4633849620064,
              45.5716243005379
            ],
            [
              -73.4632834876533,
              45.571903215937
            ],
            [
              -73.4632149106906,
              45.5720696628178
            ],
            [
              -73.4629530681969,
              45.5726724656832
            ],
            [
              -73.46272851272,
              45.5731852968636
            ],
            [
              -73.4625480588001,
              45.5735946613596
            ],
            [
              -73.4623992885522,
              45.5739455469067
            ],
            [
              -73.4622974252321,
              45.5741794695995
            ],
            [
              -73.4621085453826,
              45.5746293229754
            ],
            [
              -73.4630361008974,
              45.5748272164122
            ],
            [
              -73.4654034000153,
              45.5753322370167
            ],
            [
              -73.4685425931775,
              45.5760125173943
            ],
            [
              -73.4710165552523,
              45.5732371910552
            ],
            [
              -73.4717857391141,
              45.5723690457465
            ],
            [
              -73.4731293520996,
              45.5708621507916
            ],
            [
              -73.4745686128975,
              45.5692607785512
            ],
            [
              -73.4765545085992,
              45.5670791090363
            ],
            [
              -73.4785851260486,
              45.5648299250618
            ],
            [
              -73.4789103256694,
              45.5644790505824
            ],
            [
              -73.4795516377218,
              45.5649642852891
            ],
            [
              -73.480325908617,
              45.5655501046823
            ],
            [
              -73.482643713266,
              45.5673096538568
            ],
            [
              -73.4840534309949,
              45.5683761611779
            ],
            [
              -73.48448893124,
              45.5686911625729
            ],
            [
              -73.4846750565191,
              45.5688306617508
            ],
            [
              -73.4849296542532,
              45.5689926654904
            ],
            [
              -73.4853439353523,
              45.5693076607904
            ],
            [
              -73.4856033022772,
              45.5695731443652
            ],
            [
              -73.4856369191041,
              45.5696271385466
            ],
            [
              -73.4856621315353,
              45.569681131663
            ],
            [
              -73.4856733303145,
              45.569726124692
            ],
            [
              -73.48567332002,
              45.569766617152
            ],
            [
              -73.4856704993858,
              45.5698251059084
            ],
            [
              -73.4856620742991,
              45.5699060897721
            ],
            [
              -73.4856270830604,
              45.5699858555209
            ],
            [
              -73.4853168021938,
              45.5702694279402
            ],
            [
              -73.4852476773183,
              45.5703331622608
            ],
            [
              -73.4849179361454,
              45.5706371824541
            ],
            [
              -73.4848767641777,
              45.5706741169277
            ],
            [
              -73.4845719300049,
              45.5709475792947
            ],
            [
              -73.4842067019995,
              45.5712579715147
            ],
            [
              -73.4838270573197,
              45.5715649861394
            ],
            [
              -73.4837691069093,
              45.5716182758803
            ],
            [
              -73.4837036092974,
              45.5715722563365
            ],
            [
              -73.4823768649473,
              45.5705625078553
            ],
            [
              -73.4818669322885,
              45.5701612889097
            ]
          ],
          "type": "LineString"
        },
        "type": "Feature"
      }
    ],
    "type": "FeatureCollection"
  }
  const startStopGeoJSON = {
    "type":"FeatureCollection",
    "features":[{
      "type":"Feature",
      "geometry":{
        "type":"Point",
        "coordinates":[-73.4428402297581,45.5132794484867]
      }
    }]
  }
  const endStopGeoJSON = {
    "type":"FeatureCollection",
    "features":[{
      "type":"Feature",
      "geometry":{
        "type":"Point",
        "coordinates":[-73.4637223779911,45.5220164438496]
      }
    }]
  }
  const secondStartStopGeoJSON = {
    "type":"FeatureCollection",
    "features":[{
      "type":"Feature",
      "geometry":{
        "type":"Point",
        "coordinates":[-73.4642723874719,45.5226914971756]
      }
    }]
  }
  const secondEndStopGeoJSON = {
    "type":"FeatureCollection",
    "features":[{
      "type":"Feature",
      "geometry":{
        "type":"Point",
        "coordinates":[-73.4386955970904,45.5701649891596]
      }
    }]
  }
  const thirdStartStopGeoJSON = {
    "type":"FeatureCollection",
    "features":[{
      "type":"Feature",
      "geometry":{
        "type":"Point",
        "coordinates":[-73.4386572792928,45.5700569886993]
      }
    }]
  }
  mapboxgl.accessToken = 'pk.eyJ1IjoianVmYXVhIiwiYSI6ImNqdmNwZmJoOTBpM2o0M3J2a2ZkN3Z1MzAifQ.UMi0olk8fbTgiYfQvVRsLw';
  var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/jufaua/cjiewfbwo2mle2sqpw20a4uiq',
      center: [-73.516870,45.524649],
      hash: true,
      zoom: 11
  });

  map.on('load', function() {
    map.addSource('firstSegment', {type: 'geojson', data: turf.lineSliceAlong(
        routeGeoJSON.features[0],
        turf.nearestPointOnLine(routeGeoJSON.features[0],startStopGeoJSON.features[0]).properties.location,
        turf.nearestPointOnLine(routeGeoJSON.features[0],endStopGeoJSON.features[0]).properties.location
      )
    });
    map.addLayer({
      "id": "firstSegment",
      "type": "line",
      "source": "firstSegment",
      "layout": {
        "line-join": "round",
        "line-cap": "round",
        "visibility": 'none'
      },
      "paint": {
        "line-color": 'rgba(0,200,0,0.6)',
        "line-width": 5
      }
    });
    map.addSource('secondSegment', {type: 'geojson', data: turf.lineSliceAlong(
        secondRouteGeoJSON.features[0],
        turf.nearestPointOnLine(secondRouteGeoJSON.features[0],secondStartStopGeoJSON.features[0]).properties.location,
        turf.nearestPointOnLine(secondRouteGeoJSON.features[0],secondEndStopGeoJSON.features[0]).properties.location
      )
    });
    map.addLayer({
      "id": "secondSegment",
      "type": "line",
      "source": "secondSegment",
      "layout": {
        "line-join": "round",
        "line-cap": "round",
        "visibility": 'none'
      },
      "paint": {
        "line-color": 'rgba(0,200,0,0.6)',
        "line-width": 5
      }
    });
    map.addSource('fullRoute', {type: 'geojson', data: emptyGeoJSON});
    map.addLayer({
      "id": "fullRoute",
      "type": "line",
      "source": "fullRoute",
      "layout": {
      "line-join": "round",
      "line-cap": "round"
      },
      "paint": {
        "line-color": 'rgba(216,216,216,0.2)',
        "line-width": 5
      }
    });
    map.addSource('intermediateRoute', {type: 'geojson', data: emptyGeoJSON});
    map.addLayer({
      "id": "intermediateRoute",
      "type": "line",
      "source": "intermediateRoute",
      "layout": {
      "line-join": "round",
      "line-cap": "round"
      },
      "paint": {
        "line-color": 'rgba(168,5,50,1)',
        "line-width": 5
      }
    });
    map.addSource('secondIntermediateRoute', {type: 'geojson', data: emptyGeoJSON});
    map.addLayer({
      "id": "secondIntermediateRoute",
      "type": "line",
      "source": "secondIntermediateRoute",
      "layout": {
      "line-join": "round",
      "line-cap": "round"
      },
      "paint": {
        "line-color": 'rgba(168,5,50,1)',
        "line-width": 5
      }
    });
    map.addSource('bus', {type: 'geojson', data: emptyGeoJSON});
    map.addLayer({
      "id": "busc",
      "type": "symbol",
      "source": "bus",
      "layout": {
        'text-field': String.fromCharCode("0xF111"),
        'text-font': ['Font Awesome 5 Free Solid'],
        'text-size': 18,
        'text-allow-overlap': true
      },
      "paint": {
        "text-color": "#FFFFFF"
      }
    });
    map.addLayer({
      "id": "bus",
      "type": "symbol",
      "source": "bus",
      "layout": {
        'text-field': String.fromCharCode("0xF207"),
        'text-font': ['Font Awesome 5 Free Solid'],
        'text-size': 11,
        'text-allow-overlap': true
      },
      "paint": {
        "text-color": "#A80532"
      }
    });
    map.addSource('startStop', {type: 'geojson', data: emptyGeoJSON});
    map.addLayer({
      "id": "startStop",
      "type": "circle",
      "source": "startStop",
      "paint": {
        "circle-radius": {
          "base": 1,
          "stops": [[5,2],[10,4],[15,6]]
        },
        "circle-color": "rgba(0,255,0,0.6)",
        "circle-stroke-color": "#000000",
        "circle-stroke-width": 1,
      }
    });
    map.addSource('endStop', {type: 'geojson', data: emptyGeoJSON});
    map.addLayer({
      "id": "endStop",
      "type": "circle",
      "source": "endStop",
      "paint": {
        "circle-radius": {
          "base": 1,
          "stops": [[5,2],[10,4],[15,6]]
        },
        "circle-color": "rgba(255,0,0,0.6)",
        "circle-stroke-color": "#000000",
        "circle-stroke-width": 1,
      }
    });
    //addSources();
    //Autre source : arrets associÃ©s
    //addLayers();
  });

  function delay(n) {  
    n = n || 2000;
    return new Promise(done => {
      setTimeout(() => {
        done();
      }, n);
    });
  }

  function tempPopup(position,text) {
    return new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: true
    }).setLngLat(
      position
    ).setHTML(
      text
    ).addTo(map)
  }

  

  var popup;
  var cuttedRoute;
  var i;
  var lengthOfCuttedRoute;
  var number_of_frames;
  var animationDone = false;
  var animation;

  moveAlong = function() {
    let steps = lengthOfCuttedRoute/number_of_frames;
    map.getSource('bus').setData(turf.along(cuttedRoute, i*steps));
    let newCuttedRoute = turf.lineSliceAlong(cuttedRoute,i*steps,lengthOfCuttedRoute);
    map.getSource('intermediateRoute').setData(newCuttedRoute);
    i+=1;
    if (i < number_of_frames) {
      animation = requestAnimationFrame(moveAlong);
    } else {
      animationDone = true;
      cancelAnimationFrame(moveAlong);
    }
  }

  function scene0() {
    map.getSource('startStop').setData(emptyGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(emptyGeoJSON);
    map.getSource('intermediateRoute').setData(emptyGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('secondIntermediateRoute').setData(emptyGeoJSON);
    map.setLayoutProperty('firstSegment', 'visibility', 'none');
    map.setLayoutProperty('secondSegment', 'visibility', 'none');
  }

  function scene1() {
    map.getSource('startStop').setData(emptyGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(emptyGeoJSON);
    map.getSource('intermediateRoute').setData(emptyGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(routeGeoJSON);
    map.getSource('intermediateRoute').setData(routeGeoJSON);
    if (popup != undefined) {
      popup.remove();
    }
    map.flyTo({
      center: [-73.4446,45.5125], 
      zoom: 12
    });
    popup = tempPopup(
      turf.along(routeGeoJSON.features[0],turf.length(routeGeoJSON.features[0])/2).geometry.coordinates,
      "Validation d'une carte Ã  puce sur la ligne 8"
    );
  }

  function scene2() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('startStop').setData(emptyGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(emptyGeoJSON);
    map.getSource('intermediateRoute').setData(emptyGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(routeGeoJSON);
    map.getSource('intermediateRoute').setData(routeGeoJSON);
    map.flyTo({
      center: [-73.4433,45.5133],
      zoom: 15
    });
    popup = tempPopup(
      startStopGeoJSON.features[0].geometry.coordinates,
      "Les donnÃ©es opÃ©rationnelles permettent d'identifier la position du vÃ©hicule lors de la validation de la carte"
    )
    map.getSource('startStop').setData(startStopGeoJSON);

    let startCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],startStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(routeGeoJSON.features[0],startCuttingLineAt,turf.length(routeGeoJSON.features[0]));
  }

  function scene3() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('startStop').setData(startStopGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(routeGeoJSON);
    map.getSource('secondIntermediateRoute').setData(emptyGeoJSON);
    map.flyTo({
      center: [-73.4825,45.5276], 
      zoom: 13
    });
    popup = tempPopup(
      turf.along(cuttedRoute,turf.length(cuttedRoute)/2).geometry.coordinates,
      "L'arbre des possibilitÃ©s de l'arrÃªt de descente est rÃ©duit aux arrÃªts en aval"
    )
    let startCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],startStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(routeGeoJSON.features[0],startCuttingLineAt,turf.length(routeGeoJSON.features[0]));
    map.getSource('intermediateRoute').setData(cuttedRoute);
  }

  function scene4() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('startStop').setData(startStopGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    let startCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],startStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(routeGeoJSON.features[0],startCuttingLineAt,turf.length(routeGeoJSON.features[0]));
    map.getSource('intermediateRoute').setData(cuttedRoute);
    map.getSource('fullRoute').setData(routeGeoJSON);
    map.getSource('secondIntermediateRoute').setData(secondRouteGeoJSON);
    map.flyTo({
      center: [-73.4825,45.5276], 
      zoom: 12
    });
    popup = tempPopup(
      turf.along(secondRouteGeoJSON.features[0],turf.length(secondRouteGeoJSON.features[0])/2).geometry.coordinates,
      "Validation suivante sur la ligne 123"
    )
  }

  function scene5() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(routeGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    let startCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],startStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(routeGeoJSON.features[0],startCuttingLineAt,turf.length(routeGeoJSON.features[0]));
    map.getSource('intermediateRoute').setData(cuttedRoute);
    map.getSource('secondIntermediateRoute').setData(secondRouteGeoJSON);
    map.flyTo({
      center: [-73.4666,45.5219], 
      zoom: 14
    });
    popup = tempPopup(
      secondStartStopGeoJSON.features[0].geometry.coordinates,
      "Les donnÃ©es opÃ©rationnelles permettent de dÃ©terminer la position du vÃ©hicule Ã  la montÃ©e et l'arrÃªt utilisÃ©"
    )
    map.getSource('startStop').setData(turf.featureCollection([startStopGeoJSON.features[0],secondStartStopGeoJSON.features[0]]));
  }

  function scene6() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('startStop').setData(turf.featureCollection([startStopGeoJSON.features[0],secondStartStopGeoJSON.features[0]]));
    map.getSource('endStop').setData(endStopGeoJSON);
    map.getSource('fullRoute').setData(secondRouteGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    let startCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],startStopGeoJSON.features[0]).properties.location;
    let stopCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],endStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(routeGeoJSON.features[0],startCuttingLineAt,stopCuttingLineAt);
    map.getSource('intermediateRoute').setData(cuttedRoute);
    map.getSource('secondIntermediateRoute').setData(secondRouteGeoJSON);
    map.flyTo({
      center: [-73.4666,45.5219], 
      zoom: 14
    });
    popup = tempPopup(
      endStopGeoJSON.features[0].geometry.coordinates,
      "On peut donc infÃ©rer le lieu de descente du premier vÃ©hicule"
    )
  }

  function scene7() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('startStop').setData(turf.featureCollection([startStopGeoJSON.features[0],secondStartStopGeoJSON.features[0]]));
    map.getSource('endStop').setData(endStopGeoJSON);
    map.getSource('fullRoute').setData(secondRouteGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('secondIntermediateRoute').setData(secondRouteGeoJSON);
    map.setLayoutProperty('firstSegment', 'visibility', 'none');
    let startCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],startStopGeoJSON.features[0]).properties.location;
    let stopCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],endStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(routeGeoJSON.features[0],startCuttingLineAt,stopCuttingLineAt);
    map.getSource('intermediateRoute').setData(cuttedRoute);
    popup = tempPopup(
      turf.along(cuttedRoute,turf.length(cuttedRoute)/2).geometry.coordinates,
      "Premier segment effectuÃ©"
    )

  }

  async function scene8() {
    if (popup != undefined) {
      popup.remove();
    }
    map.flyTo({
      center: [-73.4666,45.5219], 
      zoom: 14
    });
    let startCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],startStopGeoJSON.features[0]).properties.location;
    let stopCuttingLineAt = turf.nearestPointOnLine(routeGeoJSON.features[0],endStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(routeGeoJSON.features[0],startCuttingLineAt,stopCuttingLineAt);
    map.getSource('startStop').setData(turf.featureCollection([startStopGeoJSON.features[0],secondStartStopGeoJSON.features[0]]));
    map.getSource('endStop').setData(endStopGeoJSON);
    map.getSource('fullRoute').setData(secondRouteGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('intermediateRoute').setData(cuttedRoute);
    map.getSource('secondIntermediateRoute').setData(secondRouteGeoJSON);
    map.setLayoutProperty('firstSegment', 'visibility', 'visible');
    i = 0;
    animationDone = false;
    number_of_frames = 400;

    map.getSource('startStop').setData(turf.featureCollection([startStopGeoJSON.features[0],secondStartStopGeoJSON.features[0]]));
    lengthOfCuttedRoute = turf.length(cuttedRoute);
    animation = moveAlong();
    while (!animationDone) {
      await delay(1000);
    }
    map.getSource('bus').setData(emptyGeoJSON);
  }

  function scene9() {
    if (popup != undefined) {
      popup.remove();
    }
    window.cancelAnimationFrame(animation);
    map.setLayoutProperty('firstSegment', 'visibility', 'visible');
    map.getSource('startStop').setData(secondStartStopGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(secondRouteGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('secondIntermediateRoute').setData(emptyGeoJSON);
    map.flyTo({
      center: [-73.4537,45.5482], 
      zoom: 12
    });
    startCuttingLineAt = turf.nearestPointOnLine(secondRouteGeoJSON.features[0],secondStartStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(secondRouteGeoJSON.features[0],startCuttingLineAt,turf.length(secondRouteGeoJSON.features[0]));
    map.getSource('intermediateRoute').setData(cuttedRoute);
    popup = tempPopup(
      turf.along(cuttedRoute,turf.length(cuttedRoute)/2).geometry.coordinates,
      "Arbre des possibilitÃ©s de descente pour le second segment"
    )

  }

  function scene10() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('startStop').setData(secondStartStopGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(secondRouteGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('intermediateRoute').setData(cuttedRoute);
    map.flyTo({
      center: [-73.4537,45.5482], 
      zoom: 12
    });
    popup = tempPopup(
      turf.along(cuttedRoute,turf.length(cuttedRoute)/2).geometry.coordinates,
      "Impossible de connaÃ®tre le lieu de descente tant qu'une autre validation n'a pas eu lieu"
    )
  }

  function scene11() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('startStop').setData(secondStartStopGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('fullRoute').setData(secondRouteGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    startCuttingLineAt = turf.nearestPointOnLine(secondRouteGeoJSON.features[0],secondStartStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(secondRouteGeoJSON.features[0],startCuttingLineAt,turf.length(secondRouteGeoJSON.features[0]));
    map.getSource('intermediateRoute').setData(cuttedRoute);
    map.flyTo({
      center: [-73.4363,45.5674], 
      zoom: 14
    });
    popup = tempPopup(
      thirdStartStopGeoJSON.features[0].geometry.coordinates,
      "En soirÃ©e, une nouvelle montÃ©e est effectuÃ©e sur la ligne 123"
    )
    map.getSource('startStop').setData(turf.featureCollection([secondStartStopGeoJSON.features[0],thirdStartStopGeoJSON.features[0]]));
  }

  function scene12() {
    if (popup != undefined) {
      popup.remove();
    }
    map.getSource('startStop').setData(turf.featureCollection([secondStartStopGeoJSON.features[0],thirdStartStopGeoJSON.features[0]]));
    map.getSource('fullRoute').setData(secondRouteGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.setLayoutProperty('secondSegment', 'visibility', 'none');
    map.flyTo({
      center: [-73.4363,45.5674], 
      zoom: 14
    });
    popup = tempPopup(
      secondEndStopGeoJSON.features[0].geometry.coordinates,
      "Comme pour le premier segment, on peut dÃ©sormais dÃ©terminer l'arrÃªt de descente probable du deuxiÃ¨me segment"
    )
    map.getSource('endStop').setData(secondEndStopGeoJSON);
    stopCuttingLineAt = turf.nearestPointOnLine(secondRouteGeoJSON.features[0],secondEndStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(secondRouteGeoJSON.features[0],startCuttingLineAt,stopCuttingLineAt);
    map.getSource('intermediateRoute').setData(cuttedRoute);
  }

  async function scene13() {
    if (popup != undefined) {
      popup.remove();
    }
    map.flyTo({
      center: [-73.4537,45.5482], 
      zoom: 12
    });
    map.setLayoutProperty('secondSegment', 'visibility', 'visible');
    map.getSource('startStop').setData(secondStartStopGeoJSON);
    map.getSource('endStop').setData(secondEndStopGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    startCuttingLineAt = turf.nearestPointOnLine(secondRouteGeoJSON.features[0],secondStartStopGeoJSON.features[0]).properties.location;
    stopCuttingLineAt = turf.nearestPointOnLine(secondRouteGeoJSON.features[0],secondEndStopGeoJSON.features[0]).properties.location;
    cuttedRoute = turf.lineSliceAlong(secondRouteGeoJSON.features[0],startCuttingLineAt,stopCuttingLineAt);
    map.getSource('intermediateRoute').setData(cuttedRoute);
    map.getSource('fullRoute').setData(emptyGeoJSON);
    animationDone = false;
    number_of_frames = 600;
    i = 0;
    lengthOfCuttedRoute = turf.length(cuttedRoute);
    animation = moveAlong();
    while (!animationDone) {
      await delay(1000);
    }
    map.getSource('startStop').setData(emptyGeoJSON);
    map.getSource('endStop').setData(emptyGeoJSON);
    map.getSource('intermediateRoute').setData(emptyGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    popup = tempPopup(
      secondEndStopGeoJSON.features[0].geometry.coordinates,
      "La mÃªme logique s'applique au retour, avec la possibilitÃ© d'utiliser <br />une validation d'un jour subsÃ©quent pour dÃ©terminer le lieu de descente final"
    )
  }

  function scene14() {
    //Conclusion, on fait apparaÃ®tre les donnÃ©es de segment et de dÃ©placement, et les arrÃªts de montÃ©e, descente et correspondance
    map.flyTo({
      center: [-73.4537,45.5482], 
      zoom: 12
    });
    map.setLayoutProperty('firstSegment', 'visibility', 'visible');
    map.setLayoutProperty('secondSegment', 'visibility', 'visible');
    map.getSource('startStop').setData(turf.featureCollection([startStopGeoJSON.features[0],secondStartStopGeoJSON.features[0]]));
    map.getSource('endStop').setData(turf.featureCollection([endStopGeoJSON.features[0],secondEndStopGeoJSON.features[0]]));
    map.getSource('fullRoute').setData(emptyGeoJSON);
    map.getSource('intermediateRoute').setData(emptyGeoJSON);
    map.getSource('bus').setData(emptyGeoJSON);
    map.getSource('secondIntermediateRoute').setData(emptyGeoJSON);
    popup = tempPopup(
      turf.along(cuttedRoute,turf.length(secondRouteGeoJSON)/2).geometry.coordinates,
      "Le dÃ©placement entier, ses deux segments et les arrÃªts de montÃ©e/descente"
    )
  }


  let scenes = [
    scene0,
    scene1,
    scene2,
    scene3,
    scene4,
    scene5,
    scene6,
    scene7,
    scene8,
    scene9,
    scene10,
    scene11,
    scene12,
    scene13,
    scene14
  ];
  let j = 0;
  $('#forward').on('click', function() {
    if (j >13) {
      j = -1;
    }
    if (popup != undefined) {
      popup.remove();
    }
    j += 1;
    scenes[j]();
    $('#sceneId').html(`${j}/14`);
    window.cancelAnimationFrame(animation);
  });

  $('#backward').on('click', function() {
    if (j > 0) {
      if (popup != undefined) {
        popup.remove();
      }
      j -= 1;
      scenes[j]();
      $('#sceneId').html(`${j}/14`);
      window.cancelAnimationFrame(animation);
    }
  })

  async function runFirstAnimation() {
    scene1();
    await delay(2000);
    scene2();
    await delay(2000);
    scene3();
    await delay(2000);
    scene4();    
    await delay(2000);
    scene5();
    await delay(2000);
    scene6();
    await delay(2000);
    scene7();
    await delay(2000);
    scene8();
    await delay(2000);
    scene9();
    await delay(2000);
    scene10();
    await delay(2000);
    scene11();
    await delay(2000);
    scene12();
    await delay(2000);
    scene13();
  }

  const arrowLineVertex = `
  
    #define MAPBOX_GL_JS
    #define DEVICE_PIXEL_RATIO 2.0
    #ifdef GL_ES
    precision highp float;
    #else
    
    #if !defined(lowp)
    #define lowp
    #endif
    
    #if !defined(mediump)
    #define mediump
    #endif
    
    #if !defined(highp)
    #define highp
    #endif
    
    #endif
    
    float evaluate_zoom_function_1(const vec4 values, const float t) {
      if (t < 1.0) {
          return mix(values[0], values[1], t);
      } else if (t < 2.0) {
          return mix(values[1], values[2], t - 1.0);
      } else {
          return mix(values[2], values[3], t - 2.0);
      }
    }
    vec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {
      if (t < 1.0) {
          return mix(value0, value1, t);
      } else if (t < 2.0) {
          return mix(value1, value2, t - 1.0);
      } else {
          return mix(value2, value3, t - 2.0);
      }
    }
    
    // The offset depends on how many pixels are between the world origin and the edge of the tile:
    // vec2 offset = mod(pixel_coord, size)
    //
    // At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.
    // The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.
    //
    // The pixel_coord is passed in as two 16 bit values:
    // pixel_coord_upper = floor(pixel_coord / 2^16)
    // pixel_coord_lower = mod(pixel_coord, 2^16)
    //
    // The offset is calculated in a series of steps that should preserve this precision:
    vec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,
      const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {
    
      vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);
      return (tile_units_to_pixels * pos + offset) / pattern_size;
    }
    
    
    // floor(127 / 2) == 63.0
    // the maximum allowed miter limit is 2.0 at the moment. the extrude normal is
    // stored in a byte (-128..127). we scale regular normals up to length 63, but
    // there are also "special" normals that have a bigger length (of up to 126 in
    // this case).
    // #define scale 63.0
    #define scale 0.015873016
    
    // We scale the distance before adding it to the buffers so that we can store
    // long distances for long segments. Use this value to unscale the distance.
    #define LINE_DISTANCE_SCALE 2.0
    
    // the distance over which the line edge fades out.
    // Retina devices need a smaller distance to avoid aliasing.
    #define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0
    
    attribute vec2 a_pos;
    attribute vec4 a_data;
    
    uniform mat4 u_matrix;
    uniform mediump float u_ratio;
    uniform vec2 u_patternscale_a;
    uniform float u_tex_y_a;
    uniform vec2 u_patternscale_b;
    uniform float u_tex_y_b;
    uniform vec2 u_gl_units_to_pixels;
    uniform mediump float u_width;
    uniform lowp float u_time;
    
    varying vec2 v_normal;
    varying vec2 v_width2;
    varying vec2 v_tex_a;
    varying vec2 v_tex_b;
    varying float v_gamma_scale;
    varying float v_linesofar;
    varying float v_w;
    
    #pragma mapbox: define highp vec4 color
    #pragma mapbox: define lowp float blur
    #pragma mapbox: define lowp float opacity
    #pragma mapbox: define mediump float gapwidth
    #pragma mapbox: define lowp float offset
    
    void main() {
      #pragma mapbox: initialize highp vec4 color
      #pragma mapbox: initialize lowp float blur
      #pragma mapbox: initialize lowp float opacity
      #pragma mapbox: initialize mediump float gapwidth
      #pragma mapbox: initialize lowp float offset
    
      vec2 a_extrude = a_data.xy - 128.0;
      float a_direction = mod(a_data.z, 4.0) - 1.0;
      float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;
      v_w = mod(a_data.z, 2.0);
    
      // We store the texture normals in the most insignificant bit
      // transform y so that 0 => -1 and 1 => 1
      // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap
      // y is 1 if the normal points up, and -1 if it points down
      mediump vec2 normal = mod(a_pos, 2.0);
      normal.y = sign(normal.y - 0.5);
      v_normal = normal;
    
      // these transformations used to be applied in the JS and native code bases.
      // moved them into the shader for clarity and simplicity.
      gapwidth = gapwidth / 2.0;
      float width = u_width / 2.0;
      offset = -1.0 * offset;
    
      float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);
      float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;
    
      // Scale the extrusion vector down to a normal and then up by the line width
      // of this vertex.
      mediump vec2 dist = outset * a_extrude * scale;
    
      // Calculate the offset when drawing a line that is to the side of the actual line.
      // We do this by creating a vector that points towards the extrude, but rotate
      // it when we're drawing round end points (a_direction = -1 or 1) since their
      // extrude vector points in another direction.
      mediump float u = 0.5 * a_direction;
      mediump float t = 1.0 - abs(u);
      mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);
    
      // Remove the texture normal bit to get the position
      vec2 pos = floor(a_pos * 0.5);
    
      vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);
      gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;
    
      // calculate how much the perspective view squishes or stretches the extrude
      float extrude_length_without_perspective = length(dist);
      float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);
      v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;
    
      v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);
      v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);
    
      v_width2 = vec2(outset, inset);
      v_linesofar = a_linesofar;
    }
  `;
  
  const animatedArrowLineFragment = `
    #define MAPBOX_GL_JS
    #define DEVICE_PIXEL_RATIO 2.0
    #ifdef GL_ES
    precision mediump float;
    #else
    
    #if !defined(lowp)
    #define lowp
    #endif
    
    #if !defined(mediump)
    #define mediump
    #endif
    
    #if !defined(highp)
    #define highp
    #endif
    
    #endif
    
    
    uniform sampler2D u_image;
    uniform float u_sdfgamma;
    uniform float u_mix;
    uniform lowp float u_time;
    
    varying vec2 v_normal;
    varying vec2 v_width2;
    varying vec2 v_tex_a;
    varying vec2 v_tex_b;
    varying float v_gamma_scale;
    varying float v_linesofar;
    varying float v_w;
    
    #pragma mapbox: define highp vec4 color
    #pragma mapbox: define lowp float blur
    #pragma mapbox: define lowp float opacity
    
    void main() {
      #pragma mapbox: initialize highp vec4 color
      #pragma mapbox: initialize lowp float blur
      #pragma mapbox: initialize lowp float opacity
    
      // Calculate the distance of the pixel from the line in pixels.
      float dist = length(v_normal) * v_width2.s;
    
      // Calculate the antialiasing fade factor. This is either when fading in
      // the line in case of an offset line (v_width2.t) or when fading out
      // (v_width2.s)
      float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;
      float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);
    
      //float arrow_start_position = mod(v_linesofar - u_time * 100.0, 300.0);
      float arrow_position         = mod(- (v_linesofar + dist * 15.0) + u_time * 250.0, 500.0);
    
      float amount_of_white = 0.0;
    
      //if (arrow_position <= 15.0)
      //{
      //  amount_of_white = 1.0;//arrow_start_position / 15.0;
      //}
      //if(arrow_position >= 0 && arrow_position <= 115.0)
      //{
      //  amount_of_white = (1.0 - (arrow_position - 100.0) / 100.0);
      //}
    
      float amount_of_blue = 0.0;
    
      //if (v_w < 30.0)
      //if (v_linesofar)
      //{
      //  amount_of_blue = 0.5;
      //}
      //else if (test >= 10000.0 && test < 16800.0)
      //{
      //  gl_FragColor = vec4(0.0,1.0,0.0,1.0);
      //}
      //if (arrow_position >= 0.0 && arrow_position < 10.0)
      //{
      //  amount_of_white = 0.9 * (arrow_position / 10.0);
      //  gl_FragColor = mix(mix(color, vec4(1.0,1.0,1.0,1.0), amount_of_white) * (alpha * opacity), vec4(0.0,0.0,1.0,1.0),amount_of_blue);
      //}
      //else
      if (arrow_position >= 10.0 && arrow_position < 20.0)
      {
        amount_of_white = 0.9;
        gl_FragColor = mix(mix(color, vec4(1.0,1.0,1.0,1.0), amount_of_white) * (alpha * opacity), vec4(0.0,0.0,1.0,1.0),amount_of_blue);
      }
      else if (arrow_position >= 20.0 && arrow_position < 30.0)
      {
        amount_of_white = 0.9 - 0.4 * (1.0 - (30.0 - arrow_position) / 10.0);
        gl_FragColor = mix(mix(color, vec4(1.0,1.0,1.0,1.0), amount_of_white) * (alpha * opacity), vec4(0.0,0.0,1.0,1.0),amount_of_blue);
      }
      else if (arrow_position >= 30.0 && arrow_position < 300.0)
      {
        amount_of_white = 0.5 * (1.0 - arrow_position / 300.0);
        gl_FragColor = mix(mix(color, vec4(0.0,0.0,0.0,1.0), amount_of_white) * (alpha * opacity), vec4(0.0,0.0,1.0,1.0),amount_of_blue);
      }
      else
      {
        gl_FragColor = mix(mix(color, vec4(1.0,1.0,1.0,1.0), 0.0) * (alpha * opacity), vec4(0.0,0.0,1.0,1.0),amount_of_blue);
      }
    
    
    #ifdef OVERDRAW_INSPECTOR
      gl_FragColor = vec4(1.0);
    #endif
    }
  `;
  
  
  const arrowLineFragment = `
    #define MAPBOX_GL_JS
    #define DEVICE_PIXEL_RATIO 2.0
    #ifdef GL_ES
    precision mediump float;
    #else
    
    #if !defined(lowp)
    #define lowp
    #endif
    
    #if !defined(mediump)
    #define mediump
    #endif
    
    #if !defined(highp)
    #define highp
    #endif
    
    #endif
    
    
    uniform sampler2D u_image;
    uniform float u_sdfgamma;
    uniform float u_mix;
    
    varying vec2 v_normal;
    varying vec2 v_width2;
    varying vec2 v_tex_a;
    varying vec2 v_tex_b;
    varying float v_gamma_scale;
    varying float v_linesofar;
    
    #pragma mapbox: define highp vec4 color
    #pragma mapbox: define lowp float blur
    #pragma mapbox: define lowp float opacity
    
    void main() {
      #pragma mapbox: initialize highp vec4 color
      #pragma mapbox: initialize lowp float blur
      #pragma mapbox: initialize lowp float opacity
    
      // Calculate the distance of the pixel from the line in pixels.
      float dist = length(v_normal) * v_width2.s;
    
      // Calculate the antialiasing fade factor. This is either when fading in
      // the line in case of an offset line (v_width2.t) or when fading out
      // (v_width2.s)
      float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;
      float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);
    
      float arrow_position = mod(v_linesofar + dist * 15.0, 300.0);
    
      float amount_of_white = 0.0;
    
      if (arrow_position <= 15.0)
      {
        amount_of_white = arrow_position / 15.0;
      }
      else if(arrow_position > 15.0 && arrow_position <= 30.0)
      {
        amount_of_white = (1.0 - (arrow_position - 15.0) / 15.0);
      }
    
      if (arrow_position > 0.0 && arrow_position <= 30.0)
      {
        gl_FragColor = mix(color, vec4(1.0,1.0,1.0,1.0), amount_of_white) * (alpha * opacity);
      }
      else
      {
        gl_FragColor = color * (alpha * opacity);
      }
    
    
    #ifdef OVERDRAW_INSPECTOR
      gl_FragColor = vec4(1.0);
    #endif
    }
  `;

  function setUniforms(gl, program) {
    gl.uniform1f(program.u_time, performance.now() / 1000);
  }
  
  let useProgram   = map.painter.useProgram;
  let renderLayer  = map.painter.renderLayer;
  let applyPragmas = map.painter.emptyProgramConfiguration.constructor.prototype.applyPragmas;
  function altApplyPragmasAnimatedArrowLine(source, shaderType) {
    if (shaderType === 'vertex') {
      source = arrowLineVertex;
    }
    if (shaderType === 'fragment') {
      source = animatedArrowLineFragment;
    }
    return applyPragmas.call(this, source, shaderType);
  }
  function altUseProgramAnimatedArrowLine(name, config) {
    if (name !== 'line') return useProgram.call(this, name, config);
    config.applyPragmas = altApplyPragmasAnimatedArrowLine;
    config.cacheKey = 'intermediateRoute';
    var program = useProgram.call(this, name, config);
    map.painter.gl.uniform1f(program.u_time, performance.now() / 1000);
    config.applyPragmas = applyPragmas;
    return program;
  }
  map.repaint = true;
  map.painter.renderLayer = function (painter, sourceCache, layer, coords) {
    if (layer.id === 'intermediateRoute' || layer.id === 'fullRoute' || layer.id === 'secondIntermediateRoute' || layer.id === 'firstSegment' || layer.id === 'secondSegment') {
      painter.useProgram = altUseProgramAnimatedArrowLine;
    }
    renderLayer.call(this, painter, sourceCache, layer, coords);
    painter.useProgram = useProgram;
  };
</script>
  </body>
</html>
